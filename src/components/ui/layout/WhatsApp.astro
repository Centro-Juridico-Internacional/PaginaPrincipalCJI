<div class="whatsapp-container" transition:name="WhatsAppButton">
	<div id="whatsapp-tooltip" class="whatsapp-tooltip hidden">
		¿Necesitas ayuda? ¡Escríbenos!
		<div class="tooltip-arrow"></div>
	</div>

	<a
		id="whatsapp-link"
		class="whatsapp-btn"
		href="https://web.whatsapp.com/send?phone=573124902143&text=Deseo%20tener%20m%C3%A1s%20informaci%C3%B3n"
		target="_blank"
		rel="noopener noreferrer"
		aria-label="Contactar por WhatsApp"
		title="Contactar por WhatsApp"
	>
		<div class="icon-wrapper">
			<svg class="whatsapp-icon" viewBox="0 0 16 16">
				<path
					d="M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z"
				></path>
			</svg>
		</div>
		<span class="btn-text">WhatsApp</span>
	</a>
</div>

<style>
	:root {
		--wa-color: #25d366;
		--wa-color-dark: #128c7e;
		--wa-gradient: linear-gradient(45deg, #25d366, #128c7e);
		--entry-delay: 1s;
	}

	.whatsapp-container {
		position: fixed;
		left: 24px;
		bottom: 24px;
		z-index: 1000;
		display: flex;
		flex-direction: column;
		align-items: flex-start;
		animation: slide-up 0.6s cubic-bezier(0.16, 1, 0.3, 1) var(--entry-delay) both;
	}

	.whatsapp-btn {
		display: flex;
		align-items: center;
		justify-content: flex-start;
		width: 56px;
		height: 56px;
		background: var(--wa-gradient);
		border-radius: 28px;
		text-decoration: none;
		overflow: hidden;
		transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
		box-shadow:
			0 4px 15px rgba(37, 211, 102, 0.3),
			0 10px 30px rgba(0, 0, 0, 0.1);
		position: relative;
	}

	.icon-wrapper {
		min-width: 56px;
		height: 56px;
		display: flex;
		align-items: center;
		justify-content: center;
		transition: transform 0.4s ease;
	}

	.whatsapp-icon {
		width: 32px;
		height: 32px;
		fill: white;
	}

	.btn-text {
		color: white;
		font-weight: 600;
		font-size: 1rem;
		opacity: 0;
		white-space: nowrap;
		transform: translateX(-10px);
		transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
		padding-right: 20px;
	}

	/* Pulsing Effect */
	.whatsapp-btn::after {
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		border-radius: 50%;
		background: var(--wa-color);
		z-index: -1;
		animation: pulse-ring 2s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite;
	}

	/* Hover Effects */
	@media (min-width: 768px) {
		.whatsapp-btn:hover {
			width: 160px;
			box-shadow:
				0 8px 25px rgba(37, 211, 102, 0.4),
				0 15px 40px rgba(0, 0, 0, 0.15);
		}

		.whatsapp-btn:hover .btn-text {
			opacity: 1;
			transform: translateX(0);
		}

		.whatsapp-btn:hover .icon-wrapper {
			transform: scale(1.05);
		}
	}

	.whatsapp-btn:active {
		transform: scale(0.95);
	}

	/* Tooltip / Message Bubble */
	.whatsapp-tooltip {
		background: white;
		color: #333;
		padding: 10px 16px;
		border-radius: 12px;
		font-size: 0.9rem;
		font-weight: 500;
		margin-bottom: 12px;
		box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
		position: relative;
		opacity: 0;
		transform: translateY(10px);
		transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
		pointer-events: none;
		border: 1px solid rgba(0, 0, 0, 0.05);
	}

	.whatsapp-tooltip.show {
		opacity: 1;
		transform: translateY(0);
	}

	.tooltip-arrow {
		position: absolute;
		bottom: -6px;
		left: 20px;
		width: 12px;
		height: 12px;
		background: white;
		transform: rotate(45deg);
		border-bottom: 1px solid rgba(0, 0, 0, 0.05);
		border-right: 1px solid rgba(0, 0, 0, 0.05);
	}

	/* Animations */
	@keyframes slide-up {
		from {
			opacity: 0;
			transform: translateY(40px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	@keyframes pulse-ring {
		0% {
			transform: scale(0.8);
			opacity: 0.5;
		}
		80%,
		100% {
			transform: scale(1.3);
			opacity: 0;
		}
	}

	/* Responsive Adjustments */
	@media (max-width: 767px) {
		.whatsapp-tooltip {
			left: 2px;
		}

		.whatsapp-container {
			left: 12px;
			right: auto;
			bottom: 30px;
		}

		.whatsapp-tooltip {
			align-self: flex-end;
		}

		.tooltip-arrow {
			left: 15px;
			right: auto;
		}

		/* No hover extension on mobile to avoid layout shifts */
		.whatsapp-btn {
			width: 50px;
			height: 50px;
		}

		.icon-wrapper {
			min-width: 50px;
			height: 50px;
		}

		.whatsapp-icon {
			width: 28px;
			height: 28px;
		}
	}

	.hidden {
		display: none;
	}
</style>

<script>
	const initWhatsApp = () => {
		const whatsappBtn = document.getElementById('whatsapp-link') as HTMLAnchorElement;
		const tooltip = document.getElementById('whatsapp-tooltip');

		if (whatsappBtn) {
			const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
				navigator.userAgent
			);
			const phoneNumber = '573124902143';
			const message = 'Deseo tener más información';
			const encodedMessage = encodeURIComponent(message);

			if (isMobile) {
				whatsappBtn.href = `https://api.whatsapp.com/send?phone=${phoneNumber}&text=${encodedMessage}`;
			} else {
				whatsappBtn.href = `https://web.whatsapp.com/send?phone=${phoneNumber}&text=${encodedMessage}`;
			}
		}

		// Show tooltip after 4 seconds
		if (tooltip) {
			setTimeout(() => {
				tooltip.classList.remove('hidden');
				setTimeout(() => {
					tooltip.classList.add('show');

					// Auto-hide after 10 seconds (user request)
					setTimeout(() => {
						tooltip.classList.remove('show');
						setTimeout(() => {
							tooltip.classList.add('hidden');
						}, 500);
					}, 10000);
				}, 100);
			}, 4000);

			// Hide tooltip when clicking the button
			whatsappBtn?.addEventListener('click', () => {
				tooltip.classList.remove('show');
			});
		}
	};

	// Run on initial load and View Transitions
	initWhatsApp();
	document.addEventListener('astro:page-load', initWhatsApp);
</script>
